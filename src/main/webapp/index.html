<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>lintiaoda</title>
    <link href="static/bootstrap/css/bootstrap.min.css" type="text/css" rel="stylesheet">
</head>
<body onload="getData()">
<div style="width: 300px; margin: 0 auto;">
    <br>
    <br>

</div>
<!--表格-->
<div class="container">
    <!--标题 -->
    <div class="row">
        <div class="col-md-12">
            <h1>学生信息表</h1>
        </div>
    </div>
    <!--按钮 -->
    <div class="row">
        <div class="col-md-4 col-md-offset-8 col-sm-4 col-sm-offset-8">
            <button class="btn btn-primary" data-toggle="modal" data-target="#insertModal">新增</button>
            <button class="btn btn-danger" id="user_delete_all_btn">删除</button>
        </div>
    </div>
    <div class="table-responsive" id="app" style="text-align: center">
        <br>
        <table class="table table-hover" style="text-align: center">
            <br>
            <thead>
            <tr>
                <th style="text-align: center">学号</th>
                <th style="text-align: center">名字</th>
                <th style="text-align: center">性别</th>
                <th style="text-align: center">专业</th>
                <th style="text-align: center">操作</th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="item in dataInfo">
                <td>{{item.id}}</td>
                <td>{{item.name}}</td>
                <td>{{item.sex}}</td>
                <td>{{item.major}}</td>
                <td>
                    <button class="btn btn-success" data-target="#updateModal" data-toggle="modal">更新</button>
                    <button class="btn btn-danger" onclick="deleteInfo()">删除</button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<!--新增学生信息模态框-->
<div class="modal fade" id="insertModal" tabindex="-1" role="dialog" aria-labelledby="myInsertModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title" id="myInsertModalLabel" style="text-align: center">新增学生信息</h4>
            </div>
            <div class="modal-body">
                <div style="text-align: center">
                    <label for="insertId" class="col-sm-2 control-label">学号</label>
                    <input type="text" class="form-control" id="insertId" placeholder="请输入学号" style="width: 200px">
                    <br>
                    <label for="insertName" class="col-sm-2 control-label">名字</label>
                    <input type="text" class="form-control" id="insertName" placeholder="请输入名字" style="width: 200px">
                    <br>
                    <label for="insertSex" class="col-sm-2 control-label">性别</label>
                    <input type="text" class="form-control" id="insertSex" placeholder="请输入性别" style="width: 200px">
                    <br>
                    <label for="insertMajor" class="col-sm-2 control-label">专业</label>
                    <input type="text" class="form-control" id="insertMajor" placeholder="请输入专业" style="width: 200px">
                    <br>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="text-align:center">取消</button>
                <button type="button" class="btn btn-success" style="text-align: center" onclick="insert()"
                        data-dismiss="modal">新增
                </button>
            </div>
        </div>
    </div>
</div>
<!--更新一整条数据-->
<div class="modal fade" id="updateModal" tabindex="-1" role="dialog" aria-labelledby="myUpdateModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
                <h4 class="modal-title" id="myUpdateModalLabel" style="text-align: center">更新学生信息</h4>
            </div>
            <div class="modal-body">
                <div style="text-align: center">
                    <label for="updateId" class="col-sm-2 control-label">学号</label>
                    <input type="text" class="form-control" id="updateId" placeholder="请输入学号" style="width: 200px">
                    <br>
                    <label for="updateName" class="col-sm-2 control-label">名字</label>
                    <input type="text" class="form-control" id="updateName" placeholder="请输入名字" style="width: 200px">
                    <br>
                    <label for="updateSex" class="col-sm-2 control-label">性别</label>
                    <input type="text" class="form-control" id="updateSex" placeholder="请输入性别" style="width: 200px">
                    <br>
                    <label for="updateMajor" class="col-sm-2 control-label">专业</label>
                    <input type="text" class="form-control" id="updateMajor" placeholder="请输入专业" style="width: 200px">
                    <br>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal" style="text-align:center">取消</button>
                <button type="button" class="btn btn-success" style="text-align: center" onclick="updateInfo()"
                        data-dismiss="modal">更新
                </button>
            </div>
        </div>
    </div>
</div>
<script>
    function getData() {
        axios.get('http://127.0.0.1:8085/student/findStudentList')
            .then(function (response) {
                var app = new Vue({
                    el: '#app',
                    data: {
                        dataInfo: response.data.result
                    }
                })
            })
            .catch(function (error) {
                console.log(error);
            });
    }
    // 传form表单时的写法
    // function insert() {
    //     var params = new URLSearchParams();
    //     params.append('id', document.getElementById('insertId').value);
    //     params.append('name', document.getElementById('insertName').value);
    //     params.append('sex', document.getElementById('insertSex').value);
    //     params.append('major', document.getElementById('insertMajor').value);
    //     axios.put('http://127.0.0.1:8085/student/insertStudent', params)
    //         .then(function (response) {
    //         })
    //         .catch(function (error) {
    //             console.log(error)
    //         })
    // }
    // 传json格式的写法
    function insert() {
        let id = document.getElementById("insertId").value;
        let name = document.getElementById("insertName").value;
        let sex = document.getElementById("insertSex").value;
        let major = document.getElementById("insertMajor").value;
        axios.put(`http://127.0.0.1:8085/student/insertStudent`,
            {
                id: id,
                name: name,
                sex: sex,
                major: major
            }
        )
            .then(res => {
                if (res.data.code === 1) {
                    alert("添加成功");
                    // 强制刷新页面
                    window.location.href = window.location.href;
                } else {
                    alert('添加失败');
                }
            })
            .catch(res => {
            })
    }
    // 编辑更新一整条信息
    function updateInfo() {
        let id = document.getElementById("updateId").value;
        let name = document.getElementById("updateName").value;
        let sex = document.getElementById("updateSex").value;
        let major = document.getElementById("updateMajor").value;
        axios.put(`http://127.0.0.1:8085/student/updateStudent`,
            {
                id: id,
                name: name,
                sex: sex,
                major: major
            }
        )
            .then(res => {
                if (res.data.code === 1) {
                    alert("更新成功");
                    // 强制刷新页面
                    window.location.href = window.location.href;
                } else {
                    alert('更新失败');
                }
            })
            .catch(res => {
            })
    }

    function deleteInfo() {
        // let deleteId = document.getElementById("id");
        var param = {id: 555};
        axios.delete('http://127.0.0.1:8085/student/deleteStudent', {params: param})
            .then(res => {
            })
            .catch(res => {
            })
    }
</script>
<script src="static/js/axios.min.js"></script>
<script src="static/js/vue.js"></script>
<script src="static/bootstrap/js/jquery-3.3.1.min.js"></script>
<script src="static/bootstrap/js/bootstrap-3.3.5.min.js"></script>
</body>
</html>